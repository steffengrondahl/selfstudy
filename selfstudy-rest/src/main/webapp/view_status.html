<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>View status</title>
        <style>
			table {
				border-collapse: collapse;
			}
			th, td {
				border: 1px solid black;
				padding: 4px;
			}
		</style>
    </head>
    <body>
        <h1>Self study: View status</h1>
        <p>Status fetched with AJAX using GET</p>
        <p>Input:</p>
        <p><input id="id" type="text" size="1" maxlength="1"></p>
        <p><button id="fetch">Fetch</button></p>
        <p>Result:</p>
        <table id="datatable">
            <tr>
                <th>Id</th>
                <th>Name</th>
            </tr>
        </table>
        <p><a href="index.html">Home</a></p>
        <script>
			var url = "rest/statuses";

			document.getElementById("fetch").addEventListener("click",submitQuery,false);

			function submitQuery(evt) {
				clearAll();
				var id = document.getElementById("id").value;
				var queryUrl = url + "/" + id;
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open("GET", queryUrl, true);
				xmlhttp.addEventListener("readystatechange",handleRequest,false);
				xmlhttp.setRequestHeader("Accept", "application/json");
				xmlhttp.send();
			}

			function handleRequest(evt) {
    			if (evt.target.readyState == 4 ) {
    				if(evt.target.status == 200) {
    					var jsObject = JSON.parse(evt.target.responseText);
    			        myFunction(jsObject);
    				}
    				else if(evt.target.status == 404) {
    					alert("Notification does not exist");
    				}
    				else {
    					alert("Unexpected response status " + evt.target.status);    				}
    			}
			}

			function myFunction(jsObject) {
				clearAll();
				var id = jsObject.id;
				var name = jsObject.name;
				//alert(JSON.stringify(jsObject));
				var row = document.getElementById("datatable").insertRow(1);
				var cell_id = row.insertCell(0);
				var cell_name = row.insertCell(1);
				cell_id.innerHTML = "" + id;
				cell_name.innerHTML = "" + name;
			}

			function clearAll() {
				var rows = parseInt(document.getElementById("datatable").rows.length - 1);
				while(rows > 0) {
					document.getElementById("datatable").deleteRow(rows--);
				}
			}
		</script>
    </body>
</html>