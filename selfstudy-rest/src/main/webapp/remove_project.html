<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Remove project</title>
        <style>
			table {
				border-collapse: collapse;
			}
			th, td {
				border: 1px solid black;
				padding: 4px;
			}
		</style>
        <script>
            window.addEventListener("load",initialise,false);

			function initialise(evt) {
			    var id = sessionStorage.getItem("pid");
			    sessionStorage.removeItem("pid");
			    //fetchProject(id);
			}
        </script>
    </head>
    <body>
        <h1>Self study: Remove project</h1>
        <p>Project fetched with AJAX using GET</p>
        <p>Input:</p>
        <p><input id="id" type="text" size="3" maxlength="3"></p>
        <p><button id="fetch">Fetch</button></p>
        <p>Result:</p>
        <table id="datatable">
            <tr>
                <th>Id</th>
                <th>Description</th>
                <th>Priority</th>
                <th>Status</th>
            </tr>
        </table>
        <p><a href="index.html">Home</a></p>
        <script>
			var url = "rest/projects";

			document.getElementById("fetch").addEventListener("click",submitQuery,false);

			function submitQuery(evt) {
				clearAll();
				var id = document.getElementById("id").value;
				var queryUrl = url + "/" + id;
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open("GET", queryUrl, true);
				xmlhttp.addEventListener("readystatechange",handleRequest,false);
				xmlhttp.setRequestHeader("Accept", "application/json");
				xmlhttp.send();
			}

			function handleRequest(evt) {
    			if (evt.target.readyState == 4 ) {
    				if(evt.target.status == 200) {
    					var jsObject = JSON.parse(evt.target.responseText);
    			        myFunction(jsObject);
    				}
    				else if(evt.target.status == 404) {
    					alert("Project does not exist");
    				}
    				else {
    					alert("Unexpected response status " + evt.target.status);    				}
    			}
			}

			function myFunction(jsObject) {
				clearAll();
				var id = jsObject.id;
				var description = jsObject.description;
				var priority = jsObject.priorityDTO.name;
				var status = jsObject.statusDTO.name;
				alert(JSON.stringify(jsObject));
				var row = document.getElementById("datatable").insertRow(1);
				var cell_id = row.insertCell(0);
				var cell_description = row.insertCell(1);
				var cell_priority = row.insertCell(2);
				var cell_status = row.insertCell(3);
				cell_id.innerHTML = "" + id;
				cell_description.innerHTML = "" + description;
				cell_priority.innerHTML = "" + priority;
				cell_status.innerHTML = "" + status;
			}

			function clearAll() {
				var rows = parseInt(document.getElementById("datatable").rows.length - 1);
				while(rows > 0) {
					document.getElementById("datatable").deleteRow(rows--);
				}
			}
		</script>
    </body>
</html>